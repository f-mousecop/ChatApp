<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:sys="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework">


    <CornerRadius x:Key="WindowCornerRadius">0</CornerRadius>
    <Thickness x:Key="WindowBorderThickness">1</Thickness>


    <!-- Caption height for title bar -->
    <sys:Double x:Key="CaptionHeight"
                xmlns:sys="clr-namespace:System;assembly=mscorlib">32</sys:Double>

    <!-- Core window style using WindowChrome -->
    <Style TargetType="{x:Type Window}" x:Key="CustomWindowCh">
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="UseLayoutRounding" Value="True"/>
        <Setter Property="Background" Value="{DynamicResource WindowChromeBackgroundBrush}"/>
        <Setter Property="BorderBrush" Value="{StaticResource CadetGrayBrush}"/>
        <Setter Property="BorderThickness" Value="{StaticResource WindowBorderThickness}"/>
        <Setter Property="WindowStyle" Value="None"/>
        <Setter Property="AllowsTransparency" Value="False"/>
        <Setter Property="MinHeight" Value="400"/>
        <Setter Property="MinWidth" Value="500"/>
        <Setter Property="ResizeMode" Value="CanResize"/>

        <Setter Property="WindowChrome.WindowChrome">
            <Setter.Value>
                <WindowChrome
                    CaptionHeight="32"
                    CornerRadius="{StaticResource WindowCornerRadius}"
                    GlassFrameThickness="0"
                    ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}"/>
            </Setter.Value>
        </Setter>

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Window">
                    <Border
                        x:Name="Root"
                        CornerRadius="{StaticResource WindowCornerRadius}"
                        BorderThickness="{StaticResource WindowBorderThickness}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        Background="{TemplateBinding Background}">


                        <Grid Background="LightGray">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="32"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Title bar -->
                            <Grid x:Name="TitleBar">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="auto"/>
                                    <ColumnDefinition Width="auto"/>
                                    <ColumnDefinition Width="auto"/>
                                </Grid.ColumnDefinitions>

                                <Image Grid.Column="0" 
                                       Source="/Images/Logo/favicon_plan.ico" Margin="2 2 0 2"/>

                                <TextBlock Grid.Column="1" Text="{TemplateBinding Title}"
                                   FontWeight="SemiBold"
                                   TextTrimming="CharacterEllipsis"
                                   VerticalAlignment="Center"/>


                                <Button
                                    ToolTip="Minimize"
                                    Grid.Column="2"
                                    Command="{x:Static SystemCommands.MinimizeWindowCommand}"
                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                    Style="{DynamicResource minButton}"
                                    >
                                    <Path Margin="0 0 0 5" Stroke="#fff" StrokeThickness="1"
                                          Data="M0,6 H10"
                                          RenderOptions.EdgeMode="Aliased"/>
                                </Button>

                                <Button ToolTip="Restore"
                                        x:Name="Restore"
                                        Grid.Column="3"
                                        Command="{x:Static SystemCommands.RestoreWindowCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                        Style="{DynamicResource restoreButton}"
                                        >
                                    <Path Data="M2,0 L10,0 L10,8 M0,3 L8,3 M0,2 L8,2 L8,10 L0,10 Z"
                                          Width="10" Height="10"
                                          VerticalAlignment="Center" HorizontalAlignment="Center"
                                          Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}"
                                          StrokeThickness="1"
                                          RenderOptions.EdgeMode="Aliased"/>
                                </Button>

                                <Button ToolTip="Maximize"
                                        x:Name="Maximize"
                                        Grid.Column="3"
                                        Command="{x:Static SystemCommands.MaximizeWindowCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                        Style="{DynamicResource maximizeButton}"
                                        >
                                    <Path
                                        Data="M0,1 L10,1 L10,9 L0,9 Z"
                                        Width="10" Height="9"
                                        VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}" 
                                        StrokeThickness="2"/>
                                </Button>

                                <Button
                                    ToolTip="Close"
                                    Grid.Column="4"
                                    Command="{x:Static SystemCommands.CloseWindowCommand}"
                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                    Style="{DynamicResource closeMenuButton}"
                                    >
                                    <Path
                                        Width="10" Height="10"
                                        Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}, Mode=FindAncestor}}"                                         
                                        StrokeThickness="1.5"
                                        Data="M0,0 L10,10 M0,10 L10,0"/>
                                </Button>
                            </Grid>

                            <!-- Content -->
                            <ContentPresenter Grid.Row="1" />
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="WindowState" Value="Maximized">
                            <Setter TargetName="Maximize" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="Restore" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="Root" Property="Padding" Value="10"/>
                        </Trigger>
                        <Trigger Property="WindowState" Value="Normal">
                            <Setter TargetName="Maximize" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="Restore" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="Root" Property="Padding" Value="0"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>